<!DOCTYPE html>

<html>

	<head>

		<title>
			Commusic
		</title>

		<style>

			#grad2 {
				background-size: cover;
				width: cover;
    			box-shadow: 0px 0px 5 white;
    			/* alternative for browsers that do not support gradients */
    			background-color: #141023; 
    			/* gradient default */
    			background-image: linear-gradient(to bottom right, #252774, #8b8dda, #141023);
				}
			html {
				background-color: #141023; /* For browsers that do not support gradients */
				margin: auto;
				}
			p {
				color:#ffaa00;
				text-align: center;
				margin:auto;
			}
			h1 {
				text-align: center;
				font-size:4vw;
				letter-spacing: 1px;
				text-shadow: -1px 0 #52418d, 0 1px #52418d, 1px 0 #52418d, 0 -1px #52418d;
			}
			h2 {
				text-align: center;
				font-size:3vw;
				text-shadow: -1px 0 #06130d, 0 1px #06130d, 1px 0 #06130d, 0 -1px #06130d;
			}
			form {
				text-align: center;
				font-size:2vw;

			}
			input {
    			width: 40%;
    			font-size:2.5vw;
			}
			img {
				max-width: 90%;
  				height: auto;
				}

		</style>

		<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>

	</head>


	<!--<div id="grad1" style="text-align:center;margin:auto;color:#d8e5f3;font-weight:bold;font-size:10vw;text-shadow: 3px 3px 5px #060c13;">
		Commusic
	</div>-->
	

	<body>
        <div id="app">
    		<img id="grad1" src="smoothlogoV3.png" alt="Commusic" style=" 
    			font-size:8vw;
    			text-align: center; 
    			color:#fff7e6;
    			font-weight:bold;
    			text-shadow: 3px 3px 5px #0a0811; 
    			display: block;
        		margin-left: auto;
        		margin-right: auto">

    		<h1 style="color:#9395dd;">
    			Community Video Queue
    		</h1>


    		<h2 style="color:#ffc34d;">
    			Paste a Youtube URL into the box below:
    		</h2>
		
            <form>

    			<p>
    				Video URL : 
    			</p>

    			<p>
    				<input type="text" name="youtubeaddress" v-model="videoId" />
    			</p>

    			<br />

    			<p>
    			    Password : 
    			</p>

    			<p>
    				<input type="password" name="pwd">

    			</p>

    			<br />
    			
    			<input id="urlform" type="button" value="Submit" v-on:click="submitURL()" style="width: 25%;">

    		</form>

            <ul style="color:#9395dd;">
                <video-list-item v-for="video in videos" 
                               v-bind:video-id="video.videoId"
                               v-bind:id="video.id"
                               v-bind:key="video.id"/>
            </ul>
        </div>
		
		<script>
            function logAxiosError(error) {
                if (error.response) {
                  // The request was made and the server responded with a status code
                  // that falls out of the range of 2xx
                  console.log(error.response.data);
                  console.log(error.response.status);
                  console.log(error.response.headers);
                } else if (error.request) {
                  // The request was made but no response was received
                  // `error.request` is an instance of XMLHttpRequest in the browser and an instance of
                  // http.ClientRequest in node.js
                  console.log(error.request);
                } else {
                  // Something happened in setting up the request that triggered an Error
                  console.log('Error', error.message);
                }
                console.log(error.config);
            }

            var app = new Vue({
                el: '#app',
                data: {
                    videoId: '',
                    videos: []
                },
                created() {
                    this.getData();
                    setInterval(this.getData, 5000);
                },
                methods: {
                    getData: function() {
                        axios.get("http://127.0.0.1:8080/output")
                             .then(function (response) {
                                    this.videos = response.data;
                                }.bind(this))
                             .catch(logAxiosError);
                    },
                    submitURL: function() {
                        if(this.videoId == "") {
                            window.alert("Must enter a video ID");
                            return;
                        }
                        axios.post("http://127.0.0.1:8080/output",
                            {
                                "videoId": this.videoId,
                                "service": "youtube"
                            }
                        ).then(function (response) {
                            this.videoId = "";
                            this.getData();
                        }.bind(this)).catch(logAxiosError);
                    }
                }
            });

            Vue.component('video-list-item', {
                props: ['id', 'videoId'],
                template: '<li>Id: {{videoId}} <button v-on:click="deleteVideo">Delete</button></li>',
                methods: {
                    deleteVideo: function() {
                        axios.delete("http://127.0.0.1:8080/output/" + this.id)
                             .then(function (response) {
                                app.getData();
                              }
                             .bind(this)).catch(logAxiosError);

                    }
                }
            })
		</script>

	</body>

</html>